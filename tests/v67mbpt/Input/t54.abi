# Crystalline silicon calculation of the GW corrections.
# Using analytic continuation for Screening
# Dataset 1:  ground state calculation for 6 k-points in IBZ
# Dataset 2:  calculation of the screening for imaginary freqs (1-10)
# Dataset 3:  calculation of the screening for imaginary freqs (11-21)
#

ndtset      3
gwcalctyp   1

ecut      12.0
#ecutwfn    5.0
ecutwfn    12.0
ecutsigx   3.0
ecuteps    3.0

# Definition of parameters for the calculation of the KSS file
nband1      55       # Number of (occ and empty) bands to be computed
nbdbuf1     5
tolwfr1     1.0d-10

# Calculation of the screening (epsilon^-1 matrix) with spectral method
optdriver2  3        # Screening calculation
getwfk2     1
inclvkb2    0
nband2      25
nfreqim2    20
scr_wrange2  1 10

# Calculation of the screening (epsilon^-1 matrix) with spectral method
optdriver3  3        # Screening calculation
getwfk3     1
inclvkb3    0
nband3      25
nfreqim3    20
scr_wrange3 11 21

nkptgw  2
kptgw
    0.00000000E+00  0.00000000E+00  0.00000000E+00
    5.00000000E-01  5.00000000E-01  0.00000000E+00

bdgw
    1  7    # Enclose all the degenerate states.
    1  7    # Enclose all the degenerate states.


# Data common to the three different datasets
# Definition of the unit cell: fcc
acell  3*10.217
rprim  0.0  0.5  0.5   # FCC primitive vectors (to be scaled by acell)
       0.5  0.0  0.5
       0.5  0.5  0.0

# Definition of the atom types
ntypat  1
znucl 14

# Definition of the atoms
natom 2
typat  1 1
xred
      0.0  0.0  0.0
      0.25 0.25 0.25

# Definition of the k-point grid
ngkpt   2 2 2
nshiftk 4
shiftk
        0.0 0.0 0.0
        0.0 0.5 0.5
        0.5 0.0 0.5
        0.5 0.5 0.0

# Definition of the SCF procedure
nstep   500       # Maximal number of SCF cycles
diemac  12.0

 pp_dirpath "$ABI_PSPDIR"
 pseudos "14si.psp"

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% test_chain = t54.abi, t55.abi, t56.abi
#%% [files]
#%% files_to_test =
#%%   t54.abo, tolnlines = 20, tolabs = 2.0e-2, tolrel = 5.0e-1, fld_options = -ridiculous;
#%% [paral_info]
#%% max_nprocs = 8
#%% [extra_info]
#%% authors = H. Tsai, M. Giantomassi
#%% keywords = GW
#%% description =
#%%   Crystalline silicon calculation of the GW corrections.
#%%   Using analytic continuation for Screening
#%%   Dataset 1:  ground state calculation for 6 k-points in IBZ
#%%   Dataset 2:  calculation of the screening for imaginary freqs (1-10)
#%%   Dataset 3:  calculation of the screening for imaginary freqs (11-21)
#%%<END TEST_INFO>
