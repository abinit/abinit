###################################################
# Automatic test for ABINIT:                      #
#    Test of RT-TDDFT in PAW case, ER propagator  #
#    Nickel 4 atoms, FCC, nonmagnetic  GGA, PAW   #
###################################################

# RT-TDDFT calculation
optdriver 9      # RT-TDDFT
dtele 0.001      # Electronic timestep
getwfk_filepath "t211i_WFK" # Initial wavefunctions
ntime 5          # Number of steps
td_exp_order 4   # Order of the Taylor expansion used to approximate the exponential
td_propagator 0  # Propagator (0: ER, 1: EMR)
td_prtstr 1      # Print striding 
td_restart 0     # restart (1: restart 0: from scratch)

# Unit cell
acell  3*3.5 angstrom
ntypat 1  
natom  4  
typat *1
znucl 28
rprim  
   1.0  0.0  0.0
   0.0  1.0  0.0
   0.0  0.0  1.0
xred
   0.0  0.0  0.0
   0.5  0.5  0.0
   0.5  0.0  0.5
   0.0  0.5  0.5
chkprim 0

# K-points and occupations
kptopt 1
ngkpt 2 2 2 # Not converged
nshiftk 1
shiftk 0 0 0
istwfk *1   # For consistency with following RT-TDDFT test
occopt 3
tsmear 300 K
nband 48

# Convergence parameters
ecut 10       # Not converged
pawecutdg 10  # Not converged

pp_dirpath "$ABI_PSPDIR/Pseudodojo_paw_pbe_standard/"
pseudos "Ni.xml"
  
# Printing parameters
prtwf 0  # Wavefunctions needed for next test    
prtden 0     
prteig 0    
prtebands 0  
prtdos 0     
pawprtdos 0  
pawprtvol 0 
prtgsr 0     

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% test_chain = t210.abi, t211.abi, t212.abi
#%% [files]
#%% files_to_test =
#%%   t211.abo, tolnlines = 0, tolabs = 0.0, tolrel = 0.0, fld_options= -ridiculous;
#%%   t211o_TDENER, tolnlines = 0, tolabs = 0.0, tolrel = 0.0, fld_options= -ridiculous;
#%% [shell]
#%% post_commands = ww_mv t211i_WFK t212i_WFK
#%% [paral_info]
#%% max_nprocs = 4
#%% [extra_info]
#%% authors = F. Brieuc
#%% keywords = RTTDDFT
#%% description =
#%%   FCC Nickel, nonmagnetic, GGA, PAW.
#%%   RT-TDDFT test, ER propagator.
#%% topics = RTTDDFT
#%%<END TEST_INFO>
