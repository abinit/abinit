# Multi_dataset parameters
ndtset 3
jdtset 1 2 3
getden1 0
getden  1
getctqmcdata 0

pawprtvol 3  # Printing additional information
prtvol 4     #

############################
# Structural Parameters
############################
# Definition of unit cell
acell 3*5.44761       # lattice parameter
rprim -0.5  0.5  0.5  # Primitive cell
       0.5 -0.5  0.5
       0.5  0.5 -0.5

# Definition atom
ntypat 1   # number of different types of atoms
znucl 26   # z number of atom

# Definition of the atoms
natom 1           # number of atom
typat 1           # type of atom
xred 0.0 0.0 0.0  # reduced coordinates for primitive cell

# Definition pseudopotentials
pp_dirpath "$ABI_PSPDIR"            # repository with pseudopotentials
pseudos "Fe-paw-abinit.xml"

# Definition of the k-point grid
kptopt 1
ngkpt 4 4 4              # Reciprocal space vectors are built from
                         # the rprim parameters. This is the size of the
                         # reciprocal k-points.
nshiftk 2                # Convergence of the density with regular shifts.
shiftk 0.25  0.25  0.25
      -0.25 -0.25 -0.25

############################
# Energy Parameters
############################

ecut 20         # Maximal plane-wave kinetic energy cut-off, in Hartree
pawecutdg 50    # PAW: Energy Cutoff for the Double Grid
nband 20        # Number of bands
occopt 3        # Smearing type
tsmear 1000 K   # Electronic smearing temperature

############################
# DFT Calculation
############################

usedmft1 0       # DFT alone
nstep1 30        # Number of iterations for the DFT convergence
tolvrs 1.0d-10  # Tolerance of the density for DFT convergence

# Definition of the spin properties
nsppol 2     # No spin-polarization
nspden 2     # No Scalar magnetism
nspinor 1    # No Spin-orbit
spinat 0.0 0.0 0.0

############################
# DMFT Calculation
############################
usedmft   1       # DMFT calculation
nstep     2       # Number of iterations for the DFT+DMFT convergence
nline1    4
nnsclo1   0
nline    10
nnsclo    7

# Definition for DMFT loop
dmftbandi 5             # First KS band included in the projection for Wannier orbitals
dmftbandf 13            # Last KS band included in the projection for Wannier orbitals
dmft_triqs_n_iw 1000    # Linear frequency mesh
dmft_iter 1             # Number of iterations of the DMFT part.

dmft_mxsf 0.7           # Mixing of the old and new self-energy at every iterations.
dmft_dc   8             # Double counting type. 6 is Around Mean Field (AMF)

#Definition of impurity solver
dmft_solv  6           # TRIQS in the density-density approximation
dmft_triqs_n_tau        500   # Number of time slices for G(tau).
dmft_triqs_n_cycles     1250  # Number of QMC sweeps
dmft_triqs_n_warmup_cycles_init    1000  # Thermalization
dmft_triqs_length_cycle   100

dmft_triqs_off_diag 0
dmft_triqs_dlr_wmax  1.0
dmft_triqs_basis 0
dmft_triqs_dlr_epsilon 1.d-2
dmft_fermi_step 0.02
dmft_prt_maxent 1
dmft_prtself 1
dmft_x2my2d 0
dmft_triqs_det_init_size 100
dmft_triqs_det_n_operations_before_check 10000
dmft_triqs_det_precision_error 1.d-5
dmft_triqs_det_precision_warning 1.d-8
dmft_triqs_det_singular_threshold -1.0
dmft_triqs_imag_threshold 1.d-13
dmft_triqs_measure_density_matrix 1
dmft_triqs_move_shift 0
dmft_triqs_pauli_prob 1.0
dmft_triqs_read_ctqmcdata 1
dmft_triqs_n_warmup_cycles_restart 0
dmft_triqs_time_invariance 1
dmft_triqs_use_norm_as_weight 1

#Definition of DFT+U
usepawu1    4           #
usepawu     14          #
dmatpuopt   2           #
lpawu       2           # Angular momentum for the projected Hamiltonian
upawu1      0.00 eV
upawu       5.5  eV  # Values of U for each angular momentum
jpawu1      0.00 eV
jpawu       0.84 eV  # Values of J

dmft_yukawa_param3 3

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% need_cpp_vars = HAVE_TRIQS_v3_2
#%% [paral_info]
#%% nprocs_to_test = 8
#%% max_nprocs = 8
#%% [NCPU_8]
#%% files_to_test = t113_MPI8.abo, tolnlines = 0, tolabs = 0.0, tolrel = 0.0, fld_options=-medium;;
#%% [extra_info]
#%% authors = E. Castiel, F. Gendron
#%% keywords = DMFT, TRIQS
#%% description = DFT+DMFT for Fe : test exact double counting in GGA
#%% topics = DMFT
#%%<END TEST_INFO>
