#Testing DMFT Correlated and non-correlated atoms (not realistic)  

#Multi_dataset parameters
ndtset 2      # Two datasets
jdtset 1 2      # one followed by two
getden -1     # Second one takes the density of first

# pawprtvol 3  # Printing additional information
# prtvol 4     #
 prtden -1    #  
# prtwf  0     #
 
# fftalg 512   # For tests
# wfoptalg 10
############################
# Structural Parameters
############################

#Definition of unit cell
 acell 3*6.5           # lattice parameter Bohr  

 rprim 0.0 0.5 0.5     # Primitive FCC cell
       0.5 0.0 0.5
       0.5 0.5 0.0    


#Definition atom
 ntypat 2    # number of different types of atoms
 znucl 1 26  # z number of atom

#Definition of the atoms
 natom 3            # number of atom
 typat 1 1 2        # type of atom
 xred 0.25 0.25 0.25 # reduced coordinates for primitive cell
      0.75 0.75 0.75
      0.00 0.00 0.00 

#Definition pseudopotentials
pp_dirpath "$ABI_PSPDIR"  # This is the path to the directory where  
pseudos "1h.paw,26fe.paw"   # pseudopotentials for tests are stored    
ixc 7

#Definition of the k-point grid
 kptopt 4
 ngkpt 4 4 4              # Reciprocal space vectors are built from
                          # the rprim parameters. This is the size of the
                          # reciprocal k-points.
 nshiftk 4                # Convergence of the density with regular shifts. 
 shiftk 0.5 0.5 0.5
        0.5 0.0 0.0
        0.0 0.5 0.0
        0.0 0.0 0.5

############################
# Energy Parameters
############################

 ecut 16         # Maximal plane-wave kinetic energy cut-off, in Hartree
 pawecutdg 32    # PAW: Energy Cutoff for the Double Grid
 nband 40        # Number of bands
 occopt 3        # Smearing type
 tsmear 2000 K   # Electronic smearing temperature

############################
# DFT Calculation
############################
 usedmft1 0       # DFT alone
 nstep1 30        # Number of iterations for the DFT convergence
 nline1 5         # Number of line minimizations
 nnsclo1 5        # Number of non-self consistent loop
 tolvrs1 1.0d-8   # Tolerance of the density for DFT convergence

#Definition of the spin properties
 nsppol 1     # No Spin-polarization
 nspden 4     # Non-collinear magnetism
 nspinor 2    # Spin-orbit Coupling
 spinat 0 0 0 # Magnetization vector
        0 0 0
        0 0 0

############################
# DMFT Calculation
############################
usedmft2 1        # DMFT calculation
nstep2    1       # Number of iterations for the DFT+DMFT convergence
nline2    10      # Number of line minimisations
nnsclo2   10      # Number of non-self consistent loops
tolvrs2   1.0d-12 # Tolerance of the density for DFT convergence

#Definition for DMFT loop
dmftbandi 9             # First KS band included in the projection for Wannier orbitals
dmftbandf 26            # Last KS band included in the projection for Wannier orbitals
dmft_nwlo 501           # Logarythmic frequency mesh
dmft_nwli 1000000       # Linear frequency mesh
dmft_iter 1             # Number of iterations of the DMFT part.
                        # We often use single-shot, since the charge density
                        # changes through the DFT+DMFT anyway.
dmftcheck 0
dmft_rslf 1             # Read self-energy, if nothing (like here) initialize.
dmft_mxsf 0.8           # Mixing of the old and new self-energy at every iterations.
dmft_dc   5             # Double counting type. 1 is Fully Localized Limit (FLL)
#dmft_wanorthnorm 2     # Renormalization preocedure


#Definition of impurity solver
dmft_solv          8     # CT-QMC solver in density-density approximation
dmftqmc_l        200    # Number of time slices for G(tau).
dmftqmc_n        1.0d6   # Number of QMC sweeps
dmftqmc_therm   10000   # Thermalization
dmftctqmc_gmove  0      # Global move occurence in QMC
dmftctqmc_order  25     # Perturbation order

#Definition of DFT+U
usepawu1    4           # FLL double counting without spin-polarization
usepawu2    14          # FLL double counting in DMFT without spon-polarization
dmatpuopt   2           # The density matrix: the simplest expression.
lpawu       -1 2         # Angular momentum for the projected Hamiltonian
upawu1      0.0 0.0 eV
upawu2      0.0 5.5 eV     # Values of U for each angular momentum
jpawu1      0.00 0.00 eV
jpawu2      0.00 0.84 eV     # Values of J

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% exclude_builders = alps_intel_2025_elpa,scope_gnu_12.2_mpich
#%% [paral_info]
#%% nprocs_to_test = 4,10
#%% max_nprocs = 10
#%% [NCPU_4]
#%% files_to_test = t114_MPI4.abo, tolnlines = 0, tolabs = 0.0e+00, tolrel = 0.0e+00, fld_options=-medium
#%% [NCPU_10]
#%% files_to_test = t114_MPI10.abo, tolnlines = 0, tolabs = 0.0e+00, tolrel = 0.0e+00, fld_options=-medium
#%% [extra_info]
#%% authors = F. Gendron
#%% keywords = DMFT, CTQMC
#%% description = Test Correlated and non-Correlated atoms with dmft_solv 8 and different order than test t113
#%% topics = DMFT
#%%<END TEST_INFO>
