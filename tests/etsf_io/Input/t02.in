# Crystalline LiF
# Generation of the KSS file with ETSF_IO
iomode 3
# Number of datasets: 2-step calculation
ndtset 2

# Definition of the unit cell: fcc
acell 3*7.7034756             # Lattice constants (in atomic units)

rprim 0.0 0.5 0.5             # FCC primitive vectors
      0.5 0.0 0.5             # (to be scaled by acell)
      0.5 0.5 0.0

# Definition of the system
ntypat 2                      # Number of species
znucl  3 9                    # Z number of each species
natom  2                      # Number of atoms
typat  1 2                    # Type of each atom (index in znucl)
xred   0.00    0.00    0.00   # Reduced coordinates of atom 1
       0.50   -0.50   -0.50   # Reduced coordinates of atom 2

# Definition of the plane-wave basis set
ecut 40.0                     # Kinetic energy cut-off, in Hartree

# Definition of the SCF procedure
nstep 3000                    # Maximum number of SCF cycles

# Step 1: determine the ground state
nband1  10                    # Number of bands
tolwfr1  1.0d-16              # Tolerance on wavefunctions to stop SCF cycles
kptopt1  1                    # Automatic generation of k-points
ngkpt1   4 4 4                # Number of grid points for k-point generation
prtden1  1                    # Store electronic density in a file

nstep1   1                    # Only for testing purposes !!!

# Step 2: obtain the Kohn-Sham band structure
getden2    1                  # Read electronic density from step 1
iscf2     -2                  # Non self-consistent calculation
tolwfr2    1.0d-16            # Tolerance on wavefunctions
nband2    10                  # Number of bands for the system
nbandkss2 50                  # Number of bands to output to the KSS file
kssform2   3                  # Format of the KSS file
kptopt2    1                  # Automatic generation of k-points
ngkpt2     4 4 4              # Number of grid points for k-point generation
chksymbreak 0                 # should have nshiftk 4  with shiftk 1/2 1/2 1/2  1/2 0 0  0 1/2 0   0 0 1/2
istwfk2    10*1               # Wavefunction storage mode for each k-point

 pp_dirpath "$ABI_PSPDIR"
 pseudos "03-Li.psp, 09-F.psp"

#%%<BEGIN TEST_INFO>
#%% [setup]
#%% executable = abinit
#%% [files]
#%% files_to_test = 
#%%   t02.out, tolnlines = 1, tolabs = 1.001e-09, tolrel = 3.000e-09
#%% [paral_info]
#%% max_nprocs = 1
#%% [extra_info]
#%% authors = D. Caliste
#%% keywords = GW
#%% description = 
#%%   Simple Li-F structure with KSS output. This is a two data set run,
#%%   the first dataset being a ground state calculation and the second put
#%%   nbandkss to non-null value to compute the Kohn-Sham structure. The KSS file
#%%   is generated by ETSF-IO. The density of the first dataset also use ETSF-IO
#%%   and dataset two is a good test for density restart.
#%%<END TEST_INFO>
